{"version":3,"sources":["seamless-vipps.js"],"names":["jQuery","$","document","ajaxComplete","event","xhr","settings","url","wc_checkout_params","checkout_url","indexOf","data","responseText","result","JSON","parse","hasOwnProperty","wc_sb_vipps","setJsUrl","js_url","e","window","init","form","this","form_submit","on","obj","onSubmit","initPaymentMenu","id","callback","console","log","paymentMenu","payex","hostedView","vipps","container","culture","WC_Gateway_Swedbank_Pay_Vipps","onApplicationConfigured","onPaymentCreated","onPaymentCompleted","self","location","href","redirectUrl","onPaymentCanceled","onPaymentFailed","onError","open","wc_sb_seamless","extend"],"mappings":"AACAA,OAAQ,SAAUC,GACd,aAEAA,EAAGC,UAAWC,aAAc,SAAWC,EAAOC,EAAKC,GAC/C,GAAOA,EAASC,MAAQC,mBAAmBC,cAAoBH,EAASC,IAAIG,QAAS,2BAA8B,EAAM,CACrH,MAAMC,EAAON,EAAIO,aAGjB,IACI,MAAMC,EAASC,KAAKC,MAAOJ,GAG3B,IAAOE,EAAOG,eAAgB,yBAC1B,OAAO,EAIXC,YAAYC,SAAUL,EAAOM,QAC/B,MAAQC,GACN,OAAO,MAQnBC,OAAOJ,YAAc,CACjBZ,KAAK,EAKLiB,KAAM,SAAUC,GACZC,KAAKD,KAAeA,EACpBC,KAAKC,aAAe,EACpBD,KAAKL,OAAe,KAEpBlB,EAAGuB,KAAKD,MAGHG,GAAI,QAAS,eAAgB,CAACC,IAAON,OAAOJ,aAAcO,KAAKI,UAG/DF,GAAI,gDAUbG,gBAAiB,SAAWC,EAAIC,GAC5BC,QAAQC,IAAK,wBAEY,IAAbF,IACRA,EAAW,cAIfP,KAAKU,YAAcb,OAAOc,MAAMC,WAAWC,MAAO,CAC9CC,UAAWR,EACXS,QAASC,8BAA8BD,QACvCE,wBAAyB,SAAU9B,GAC/BqB,QAAQC,IAAK,2BACbD,QAAQC,IAAKtB,GACboB,EAAU,OAEdW,iBAAkB,WACdV,QAAQC,IAAK,qBAEjBU,mBAAoB,SAAWhC,GAC3BqB,QAAQC,IAAK,sBACbD,QAAQC,IAAKtB,GAEbiC,KAAKC,SAASC,KAAOnC,EAAKoC,aAE9BC,kBAAmB,SAAWrC,GAC1BqB,QAAQC,IAAK,qBACbD,QAAQC,IAAKtB,IAEjBsC,gBAAiB,SAAWtC,GACxBqB,QAAQC,IAAK,mBACbD,QAAQC,IAAKtB,GAEbiC,KAAKC,SAASC,KAAOnC,EAAKoC,aAE9BG,QAAS,SAAWvC,GAChBqB,QAAQC,IAAKtB,GACboB,EAAUpB,MAIlBa,KAAKU,YAAYiB,gBAIlB9B,OAAO+B,eAAe9B,KAC7BrB,EAAEoD,OAAQhC,OAAOJ,YAAaI,OAAO+B,gBAErC/B,OAAOJ,YAAYK,KAAMrB,EAAG","file":"seamless-vipps.min.js","sourcesContent":["/* global wc_checkout_params */\njQuery( function( $ ) {\n    'use strict';\n\n    $( document ).ajaxComplete( function ( event, xhr, settings ) {\n        if ( ( settings.url === wc_checkout_params.checkout_url ) || ( settings.url.indexOf( 'wc-ajax=complete_order' ) > -1 ) ) {\n            const data = xhr.responseText;\n\n            // Parse\n            try {\n                const result = JSON.parse( data );\n\n                // Check is response from payment gateway\n                if ( ! result.hasOwnProperty( 'is_swedbank_pay_vipps' ) ) {\n                    return false;\n                }\n\n                // Save js_url value\n                wc_sb_vipps.setJsUrl( result.js_url );\n            } catch ( e ) {\n                return false;\n            }\n        }\n    } );\n\n    /**\n     * Object to handle Vipps payment forms.\n     */\n    window.wc_sb_vipps = {\n        xhr: false,\n\n        /**\n         * Initialize e handlers and UI state.\n         */\n        init: function( form ) {\n            this.form         = form;\n            this.form_submit  = false;\n            this.js_url       = null;\n\n            $( this.form )\n                // We need to bind directly to the click (and not checkout_place_order_payex_checkout) to avoid popup blockers\n                // especially on mobile devices (like on Chrome for iOS) from blocking payex_checkout(payment_id, {}, 'open'); from opening a tab\n                .on( 'click', '#place_order', {'obj': window.wc_sb_vipps}, this.onSubmit )\n\n                // WooCommerce lets us return a false on checkout_place_order_{gateway} to keep the form from submitting\n                .on( 'submit checkout_place_order_payex_psp_vipps' );\n        },\n\n        /**\n         * Initiate Payment Menu.\n         * Payment Javascript must be loaded.\n         *\n         * @param id\n         * @param callback\n         */\n        initPaymentMenu: function ( id, callback ) {\n            console.log( 'initPaymentMenu' );\n\n            if ( typeof callback === 'undefined' ) {\n                callback = function () {};\n            }\n\n            // Load Vipps frame\n            this.paymentMenu = window.payex.hostedView.vipps( {\n                container: id,\n                culture: WC_Gateway_Swedbank_Pay_Vipps.culture,\n                onApplicationConfigured: function( data ) {\n                    console.log( 'onApplicationConfigured' );\n                    console.log( data );\n                    callback( null );\n                },\n                onPaymentCreated: function () {\n                    console.log( 'onPaymentCreated' );\n                },\n                onPaymentCompleted: function ( data ) {\n                    console.log( 'onPaymentCompleted' );\n                    console.log( data );\n\n                    self.location.href = data.redirectUrl;\n                },\n                onPaymentCanceled: function ( data ) {\n                    console.log( 'onPaymentCanceled' );\n                    console.log( data );\n                },\n                onPaymentFailed: function ( data ) {\n                    console.log( 'onPaymentFailed' );\n                    console.log( data );\n\n                    self.location.href = data.redirectUrl;\n                },\n                onError: function ( data ) {\n                    console.log( data );\n                    callback( data );\n                }\n            } );\n\n            this.paymentMenu.open();\n        },\n    };\n\n    delete window.wc_sb_seamless.init;\n    $.extend( window.wc_sb_vipps, window.wc_sb_seamless );\n\n    window.wc_sb_vipps.init( $( \"form.checkout, form#order_review, form#add_payment_method\" ) );\n} );\n"]}